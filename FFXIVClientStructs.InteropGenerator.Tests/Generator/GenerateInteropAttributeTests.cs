using Xunit;
using VerifyIG = FFXIVClientStructs.InteropGenerator.Tests.Helpers.IncrementalGeneratorVerifier<FFXIVClientStructs.InteropGenerator.Generator.InteropGenerator>;

namespace FFXIVClientStructs.InteropGenerator.Tests.Generator;

public class GeneralTests {
    [Fact]
    public async Task NoMarkerAttribute() {
        const string code = """
                            using FFXIVClientStructs.InteropGenerator.Runtime.Attributes;

                            public partial struct TestStruct
                            {
                            }
                            """;

        await VerifyIG.VerifyGeneratorAsync(
            code,
            []);
    }

    [Fact]
    public async Task MarkerAttribute() {
        const string code = """
                            using FFXIVClientStructs.InteropGenerator.Runtime.Attributes;

                            [GenerateInterop]
                            public partial struct TestStruct
                            {
                            }
                            """;

        const string result = """
                              // <auto-generated/>
                              unsafe partial struct TestStruct
                              {
                              }
                              """;

        await VerifyIG.VerifyGeneratorAsync(
            code,
            ("TestStruct.InteropGenerator.g.cs", result));
    }

    [Fact]
    public async Task StructWithNamespace() {
        const string code = """
                            using FFXIVClientStructs.InteropGenerator.Runtime.Attributes;

                            namespace TestNamespace.InnerNamespace;

                            [GenerateInterop]
                            public partial struct TestStruct
                            {
                            }
                            """;

        const string result = """
                              // <auto-generated/>
                              namespace TestNamespace.InnerNamespace;

                              unsafe partial struct TestStruct
                              {
                              }
                              """;

        await VerifyIG.VerifyGeneratorAsync(
            code,
            ("TestNamespace.InnerNamespace.TestStruct.InteropGenerator.g.cs", result));
    }

    [Fact]
    public async Task NestedStruct() {
        const string code = """
                            using FFXIVClientStructs.InteropGenerator.Runtime.Attributes;

                            public partial struct TestStruct
                            {
                                [GenerateInterop]
                                public partial struct InnerStruct
                                {
                                }
                            }
                            """;

        const string result = """
                              // <auto-generated/>
                              unsafe partial struct TestStruct
                              {
                                  unsafe partial struct InnerStruct
                                  {
                                  }
                              }
                              """;

        await VerifyIG.VerifyGeneratorAsync(
            code,
            ("TestStruct+InnerStruct.InteropGenerator.g.cs", result));
    }
}
